<!--
 -
 - Licensed to the Apache Software Foundation (ASF) under one
nn - or more contributor license agreements.  See the NOTICE file
 -n distributed with this work for additional information
 - regarding copyright ownership.  The ASF licenses this file
 - to you under the Apache License, Version 2.0 (the
 - "License"); you may not use this file except in compliance
 - with the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing,
 - software distributed under the License is distributed on an
 - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 - KIND, either express or implied.  See the License for the
 - specific language governing permissions and limitations
 - under the License.
 -
 -->
<project name="Slow Consumer Disconnect" default="build">

    <property name="module.depends" value="common broker broker-plugins"/>
    <property name="module.test.depends" value="broker/test common/test systests client management/common"/>
    <property name="module.manifest" value="MANIFEST.MF"/>
    <property name="module.plugin" value="true"/>

    <import file="../../../module.xml"/>

    <target name="bundle" depends="bundle-tasks"/>



    <target name="precompile" depends="gen_logging"/>


    <property name="velocity.properties.dir" value="src/main/java/org/apache/qpid/server/virtualhost/plugin/logging"/>

    <property name="gentools.home" location="${project.root}/../gentools" />

    <property name="generated.package" value="org/apache/qpid/server/virtualhost/plugin/logging" />
    <property name="generated.dir" location="${module.precompiled}/${generated.package}" />
    <property name="velocity.compile.dir" value="${build.scratch}/broker/velocity"/>
    <property name="velocity.timestamp" location="${generated.dir}/velocity.timestamp" />


    <target name="check_velocity_deps">
      <uptodate property="velocity.notRequired" targetfile="${velocity.timestamp}">
        <srcfiles dir="${velocity.properties.dir}" includes="LogMessages**" />
        <srcfiles dir="${project.root}/broker/src/velocity/" includes="**/*.java **/*.vm" />
      </uptodate>
    </target>




    <target name="gen_logging" depends="check_velocity_deps" unless="velocity.notRequired">
      <mkdir dir="${generated.dir}"/>
      <java classname="org.apache.qpid.server.logging.GenerateLogMessages" fork="true" dir="${gentools.home}/src" failonerror="true">
        <arg value="-j"/>
        <arg value="-o"/>
        <arg value="${generated.dir}"/>
        <arg value="-t"/>
        <arg value="${project.root}/broker/src/velocity/templates/org/apache/qpid/server/logging/messages"/>
        <arg value="-r"/>
        <arg value="org.apache.qpid.server.virtualhost.plugin.logging.LogMessages"/>
        <classpath>
          <pathelement path="${project.root}/broker-plugins/experimental/slowconsumerdetection/src/main/java"/>
          <pathelement path="${velocity.compile.dir}" />
          <fileset dir="${project.root}/lib">
            <include name="**/*.jar"/>
          </fileset>
          <pathelement path="${gentools.home}/lib/velocity-1.4.jar" />
        </classpath>
      </java>
      <touch file="${velocity.timestamp}" />
    </target>


</project>
